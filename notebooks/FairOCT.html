<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="RobustOCT Examples" href="RobustOCT.html" /><link rel="prev" title="FlowOCT Examples" href="FlowOCT.html" />

    <!-- Generated with Sphinx 7.3.7 and Furo 2024.05.06 -->
        <title>Fair Optimal Classification Trees - odtlearn 0.1.dev1+g3b5fc21 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=387cc868" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" /
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">odtlearn 0.1.dev1+g3b5fc21 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/img/ODTlearn-color.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/img/ODTlearn-color.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">odtlearn 0.1.dev1+g3b5fc21 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation Guide</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../user_guide/index.html">User Guide</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of User Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/optimal_classification_trees.html">Optimal Classification Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/fair_optimal_classification_trees.html">Fair Optimal Classification Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/optimal_robust_classification_trees.html">Robust Optimal Classification Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/optimal_prescriptive_trees.html">Optimal Prescriptive Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/adding_constraints.html">Adding side constraints to optimal classification trees</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api.html">ODTlearn API</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of ODTlearn API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../autoapi/odtlearn/index.html">odtlearn</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of odtlearn</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/odtlearn/utils/index.html">odtlearn.utils</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of odtlearn.utils</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/odtlearn/utils/Tree/index.html">odtlearn.utils.Tree</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/odtlearn/utils/TreePlotter/index.html">odtlearn.utils.TreePlotter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/odtlearn/utils/binarize/index.html">odtlearn.utils.binarize</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/odtlearn/utils/callback_helpers/index.html">odtlearn.utils.callback_helpers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/odtlearn/utils/callbacks/index.html">odtlearn.utils.callbacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/odtlearn/utils/solver/index.html">odtlearn.utils.solver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/odtlearn/utils/validation/index.html">odtlearn.utils.validation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/odtlearn/constrained_oct/index.html">odtlearn.constrained_oct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/odtlearn/datasets/index.html">odtlearn.datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/odtlearn/fair_oct/index.html">odtlearn.fair_oct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/odtlearn/flow_oct/index.html">odtlearn.flow_oct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/odtlearn/flow_oct_ms/index.html">odtlearn.flow_oct_ms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/odtlearn/flow_oct_ss/index.html">odtlearn.flow_oct_ss</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/odtlearn/flow_opt/index.html">odtlearn.flow_opt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/odtlearn/flow_opt_ms/index.html">odtlearn.flow_opt_ms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/odtlearn/flow_opt_ss/index.html">odtlearn.flow_opt_ss</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/odtlearn/opt_ct/index.html">odtlearn.opt_ct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/odtlearn/opt_dt/index.html">odtlearn.opt_dt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/odtlearn/opt_pt/index.html">odtlearn.opt_pt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/odtlearn/robust_oct/index.html">odtlearn.robust_oct</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Notebooks</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Example Notebooks</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Example Notebooks</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="FlowOCT.html"><code class="docutils literal notranslate"><span class="pre">FlowOCT</span></code> Examples</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Fair Optimal Classification Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="RobustOCT.html"><code class="docutils literal notranslate"><span class="pre">RobustOCT</span></code> Examples</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">How to contribute to ODTlearn</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/notebooks/FairOCT.ipynb.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.datasets import make_classification
from sklearn.model_selection import train_test_split

from odtlearn.fair_oct import FairSPOCT
from odtlearn.utils.binarize import Binarizer, binarize
<br/></pre></div>
</div>
</div>
<section id="Fair-Optimal-Classification-Trees">
<h1>Fair Optimal Classification Trees<a class="headerlink" href="#Fair-Optimal-Classification-Trees" title="Link to this heading">¶</a></h1>
<section id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Link to this heading">¶</a></h2>
<p>The goal of this notebook is to demonstrate how users can utilize the FairOCT classes in the ODTlearn package to learn fair optimal classification trees. We will focus on the FairSPOCT class, which enforces statistical parity, and show how different parameter values affect the learned tree structure and fairness metrics. Additionally, we will introduce other fairness metrics available in the package.</p>
</section>
<section id="Loan-Approval-Dataset">
<h2>Loan Approval Dataset<a class="headerlink" href="#Loan-Approval-Dataset" title="Link to this heading">¶</a></h2>
<p>In this example, we generate a synthetic dataset related to loan approval decisions. The dataset has 5 features: Age, Income, Credit_Score, Employment_Status, Education_Level, and Previous_Default. The target variable is Loan_Approval, which indicates whether a loan application is approved (1) or denied (0). We also include a protected attribute, Gender, to simulate a fairness-related scenario.</p>
<p>When using the FairSPOCT class to learn fair optimal decision trees, there are several key parameters to consider:</p>
<ol class="arabic simple">
<li><p>depth: This parameter controls the maximum depth of the decision tree. A larger depth allows for more complex trees, but may lead to overfitting. It’s recommended to start with a small depth (e.g., 2 or 3) and gradually increase it while monitoring the performance on a validation set.</p></li>
<li><p>_lambda: This is the regularization parameter that balances the trade-off between accuracy and tree complexity. A higher value of _lambda encourages simpler trees. It’s typically set to a small value (e.g., 0.01 or 0.1) to prevent overfitting. You can tune this parameter using cross-validation.</p></li>
<li><p>fairness_bound: This parameter controls the strictness of the fairness constraint. A value of 1 means no fairness constraint is enforced, while smaller values enforce stricter fairness constraints. The choice of fairness_bound depends on the desired level of fairness and the trade-off with accuracy. It’s recommended to start with a value close to 1 and gradually decrease it while monitoring the fairness metrics and accuracy.</p></li>
</ol>
<p>The other parameters in the FairSPOCT class include:</p>
<ul class="simple">
<li><p>solver: The solver to use for the optimization problem. We use “gurobi” in this example, but you can also use “cbc” for the open-source COIN-OR Branch and Cut solver.</p></li>
<li><p>positive_class: The value of the class label corresponding to the desired outcome. In this case, we set it to 1, representing loan approval.</p></li>
<li><p>time_limit: The maximum time (in seconds) allowed for solving the optimization problem.</p></li>
<li><p>num_threads: The number of threads the solver should use. If set to None, it will use all available threads.</p></li>
<li><p>obj_mode: The objective to be used for learning the optimal decision tree. We set it to “acc” to optimize for accuracy, but you can also use “balance” for balanced accuracy or even “weighted” to specify your own weights for each observation.</p></li>
<li><p>verbose: If set to True, the solver will display verbose output during the optimization process.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>n = 100
X, y = make_classification(n_samples=n, n_features=5, n_informative=3,
                            n_redundant=1, n_classes=2, weights=[0.7, 0.3], random_state=42)

# Create a DataFrame with feature names
df = pd.DataFrame(X, columns=[&#39;Age&#39;, &#39;Income&#39;, &#39;Credit_Score&#39;, &#39;Employment_Status&#39;, &#39;Education_Level&#39;])
df[&#39;Previous_Default&#39;] = np.random.choice([0,1,], size=n, p = [0.9, 0.1])
df[&#39;Loan_Approval&#39;] = y

# Add a protected attribute (e.g., Gender)
df[&#39;Gender&#39;] = np.random.choice([&#39;Male&#39;, &#39;Female&#39;], size=n, p=[0.6, 0.4])

# Split the data into training and testing sets
X_train, X_test, y_train, y_test, gender_train, gender_test, prev_default_train, prev_default_test = train_test_split(
    df.drop([&#39;Loan_Approval&#39;, &#39;Previous_Default&#39;, &#39;Gender&#39;], axis=1),
    df[&#39;Loan_Approval&#39;],
    df[&#39;Gender&#39;],
    df[&#39;Previous_Default&#39;],
    test_size=0.2,
    random_state=42
)
<br/></pre></div>
</div>
</div>
<p>Next we use the <code class="docutils literal notranslate"><span class="pre">Binarizer</span></code> class to transform the features to binary features. Note that many of these features would likely be encoded as categorical or binary features in real data, but for our toy example we will pretend they are all continuous features.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Binarize continuous features
feat_binarizer = Binarizer(
    real_cols=[&#39;Age&#39;, &#39;Income&#39;, &#39;Credit_Score&#39;, &#39;Employment_Status&#39;, &#39;Education_Level&#39;]
)
X_train_bin = feat_binarizer.fit_transform(X_train)
X_test_bin = feat_binarizer.transform(X_test)
</pre></div>
</div>
</div>
</section>
<section id="Learning-Fair-Optimal-Classification-Trees-with-Statistical-Parity">
<h2>Learning Fair Optimal Classification Trees with Statistical Parity<a class="headerlink" href="#Learning-Fair-Optimal-Classification-Trees-with-Statistical-Parity" title="Link to this heading">¶</a></h2>
<p>Let’s investigate the effect of different fairness bound values on the learned tree structure and fairness metrics.</p>
<section id="Initialize-FairSPOCT-classifier-with-a-less-strict-fairness-bound">
<h3>Initialize FairSPOCT classifier with a less strict fairness bound<a class="headerlink" href="#Initialize-FairSPOCT-classifier-with-a-less-strict-fairness-bound" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fcl_less_strict = FairSPOCT(
    solver=&quot;gurobi&quot;,
    positive_class=1,
    depth=3,
    _lambda=0.01,
    time_limit=60,
    fairness_bound=1,
    num_threads=None,
    obj_mode=&quot;acc&quot;,
    verbose=False,
)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Set parameter Username
Academic license - for non-commercial use only - expires 2025-06-28
Set parameter TimeLimit to value 60
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Fit the classifier
fcl_less_strict.fit(X=X_train_bin,
                    y=y_train.values,
                    protect_feat=gender_train.map({&#39;Male&#39;: 0, &#39;Female&#39;: 1}).values.reshape(-1,1),
                    legit_factor=prev_default_train.values)
<br/><br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Set parameter NodeLimit to value 1073741824
Set parameter SolutionLimit to value 1073741824
Set parameter IntFeasTol to value 1e-06
Set parameter Method to value 3
Gurobi Optimizer version 10.0.2 build v10.0.2rc0 (mac64[arm])

CPU model: Apple M1 Pro
Thread count: 8 physical cores, 8 logical processors, using up to 8 threads

Optimize a model with 7232 rows, 3785 columns and 29354 nonzeros
Model fingerprint: 0x43381646
Variable types: 30 continuous, 3755 integer (3755 binary)
Coefficient statistics:
  Matrix range     [2e-02, 1e+00]
  Objective range  [1e-02, 1e+00]
  Bounds range     [1e+00, 1e+00]
  RHS range        [1e+00, 1e+00]
Found heuristic solution: objective 56.4300000
Presolve removed 3367 rows and 996 columns
Presolve time: 0.33s
Presolved: 3865 rows, 2789 columns, 19713 nonzeros
Variable types: 28 continuous, 2761 integer (2759 binary)
Concurrent LP optimizer: primal simplex, dual simplex, and barrier
Showing barrier log only...

Root barrier log...

Ordering time: 0.01s

Barrier statistics:
 Dense cols : 141
 AA&#39; NZ     : 1.943e+04
 Factor NZ  : 1.051e+05 (roughly 4 MB of memory)
 Factor Ops : 8.299e+06 (less than 1 second per iteration)
 Threads    : 6

                  Objective                Residual
Iter       Primal          Dual         Primal    Dual     Compl     Time
   0   4.97225075e+03  3.00467936e+04  7.17e+02 2.47e-01  5.00e+01     0s

Barrier performed 0 iterations in 0.48 seconds (0.31 work units)
Barrier solve interrupted - model solved by another algorithm


Solved with dual simplex

Root relaxation: objective 7.918750e+01, 2041 iterations, 0.11 seconds (0.06 work units)

    Nodes    |    Current Node    |     Objective Bounds      |     Work
 Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time

     0     0   79.18750    0  401   56.43000   79.18750  40.3%     -    0s
H    0     0                      69.2900000   79.18750  14.3%     -    0s
H    0     0                      70.2600000   79.18750  12.7%     -    0s
     0     0   79.18390    0  655   70.26000   79.18390  12.7%     -    0s
     0     0   79.18000    0  703   70.26000   79.18000  12.7%     -    0s
     0     0   79.18000    0  651   70.26000   79.18000  12.7%     -    1s
     0     0   79.18000    0  644   70.26000   79.18000  12.7%     -    1s
     0     0   79.18000    0  604   70.26000   79.18000  12.7%     -    1s
     0     0   79.17900    0  572   70.26000   79.17900  12.7%     -    1s
H    0     0                      71.2500000   79.17701  11.1%     -    1s
     0     0   79.17701    0  324   71.25000   79.17701  11.1%     -    1s
H    0     0                      73.2200000   79.17701  8.14%     -    1s
     0     0   79.17701    0  555   73.22000   79.17701  8.14%     -    1s
     0     0   79.17468    0  374   73.22000   79.17468  8.13%     -    1s
     0     0   79.17455    0  554   73.22000   79.17455  8.13%     -    1s
     0     0   79.17292    0  340   73.22000   79.17292  8.13%     -    2s
     0     0   79.17000    0  573   73.22000   79.17000  8.13%     -    2s
     0     0   79.17000    0  553   73.22000   79.17000  8.13%     -    2s
     0     2   79.17000    0  553   73.22000   79.17000  8.13%     -    2s
*  260   140              28      74.1800000   79.17000  6.73%   148    3s
H  339   159                      75.1800000   79.17000  5.31%   138    3s
H  340   159                      76.1600000   79.17000  3.95%   138    3s
H  344   159                      76.1700000   79.17000  3.94%   139    3s
  1028   345   77.66500   18  376   76.17000   79.16444  3.93%   138    5s
* 1154   342              21      76.1800000   79.16000  3.91%   135    5s

Cutting planes:
  Gomory: 1
  Cover: 31
  MIR: 4
  Flow cover: 3
  Inf proof: 2
  Zero half: 81

Explored 5122 nodes (570604 simplex iterations) in 9.22 seconds (12.15 work units)
Thread count was 8 (of 8 available processors)

Solution count 10: 76.18 76.17 76.16 ... 56.43

Optimal solution found (tolerance 1.00e-04)
Best objective 7.618000000000e+01, best bound 7.618000000000e+01, gap 0.0000%

User-callback calls 12273, time in user-callback 0.14 sec
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FairSPOCT(solver=gurobi,depth=3,time_limit=60,num_threads=None,verbose=False)
</pre></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">fit</span></code> function is used to train the fair optimal classification tree on the given dataset. It takes the following arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">X</span></code>: The feature matrix containing the predictive features for each instance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y</span></code>: The target vector indicating the class labels for each instance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">protect_feat</span></code>: The protected feature to be used for enforcing fairness constraints. In this example, we use the ‘Gender’ feature.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">legit_factor</span></code>: The legitimate factor that can justify differences in outcomes across protected groups. In this example, we use the ‘Number_of_Defaults’ feature as the legitimate factor.</p></li>
</ul>
<p>When choosing features for legitimate factors versus predictive features, consider the following:</p>
<ul class="simple">
<li><p>Legitimate factors should be variables that are deemed acceptable to influence the outcome, even if they may result in differences across protected groups. These factors should be based on domain knowledge and societal norms. For example, in a loan approval scenario, the number of previous loan defaults might be considered a legitimate factor.</p></li>
<li><p>Predictive features, on the other hand, are variables that are used to make predictions but should not lead to unfair treatment of protected groups. These features should be carefully selected to avoid perpetuating biases or discrimination. For instance, while ‘Age’ and ‘Income’ might be predictive of loan approval, they should not be used in a way that unfairly disadvantages certain protected groups.</p></li>
</ul>
<p>It is essential to engage with domain experts, stakeholders, and affected communities to determine which features should be considered legitimate factors and which should be used solely for prediction purposes. This helps ensure that the fair optimal classification tree aligns with the specific fairness requirements and societal expectations of the problem at hand.</p>
<p>In addition to looking at the progress log displayed when calling <code class="docutils literal notranslate"><span class="pre">fit</span></code>, we can check optimization statistics by looking at properties such as <code class="docutils literal notranslate"><span class="pre">optim_gap</span></code> and <code class="docutils literal notranslate"><span class="pre">num_solutions</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fcl_less_strict.optim_gap
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.0
</pre></div></div>
</div>
<p>We also provide a simple function allowing users to plot the search progress log over time. Note that you must set the attribute <code class="docutils literal notranslate"><span class="pre">store_search_progress_log</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code> before calling the <code class="docutils literal notranslate"><span class="pre">fit</span></code> method to ensure that the bound information is stored.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fcl_progress_example = FairSPOCT(
    solver=&quot;gurobi&quot;,
    positive_class=1,
    depth=3,
    _lambda=0.01,
    time_limit=60,
    fairness_bound=1,
    num_threads=None,
    obj_mode=&quot;acc&quot;,
    verbose=False,
)
fcl_progress_example.store_search_progress_log = True
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Fit the classifier
fcl_progress_example.fit(X=X_train_bin,
                    y=y_train.values,
                    protect_feat=gender_train.map({&#39;Male&#39;: 0, &#39;Female&#39;: 1}).values.reshape(-1,1),
                    legit_factor=prev_default_train.values)
</pre></div>
</div>
</div>
<p>Once the optimal decision tree has been fit, you can generate a customizable a plot of the upper and lower bounds by calling the <code class="docutils literal notranslate"><span class="pre">plot_search_progress</span></code> method.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fcl_progress_example.plot_search_progress(log_scale=True)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:title={&#39;center&#39;:&#39;Search Progress&#39;}, xlabel=&#39;Time (s)&#39;, ylabel=&#39;Objective Bound&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_FairOCT_17_1.png" src="../_images/notebooks_FairOCT_17_1.png" />
</div>
</div>
<p>Next we calculate the fairness metric and accuracy on the test data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>sp_metric = fcl_less_strict.calc_metric(
        protect_feat=gender_test.map({&#39;Male&#39;: 0, &#39;Female&#39;: 1}).values.reshape(-1,1),
        y= fcl_less_strict.predict(X_test_bin))
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(&quot;Statistical Parity on Testing Set (Less Strict Fairness Bound):&quot;)
print(pd.DataFrame(
    sp_metric.items(),
    columns=[&quot;(p,y)&quot;, &quot;P(Y=y|P=p)&quot;],
))
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Statistical Parity on Testing Set (Less Strict Fairness Bound):
    (p,y)  P(Y=y|P=p)
0  (0, 0)    0.928571
1  (1, 0)    0.500000
2  (0, 1)    0.071429
3  (1, 1)    0.500000
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>test_acc = np.mean(fcl_less_strict.predict(X_test_bin) == y_test)
print(f&quot;Test Accuracy (Less Strict Fairness Bound): {test_acc:.3f}&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Test Accuracy (Less Strict Fairness Bound): 0.850
</pre></div></div>
</div>
<p>We can also plot the learned decision tree. Notice that we can pass shorter versions of the feature names to the <code class="docutils literal notranslate"><span class="pre">plot_tree</span></code> method to make the plot easier to read. We can also adjust the distance between levels of the tree using the <code class="docutils literal notranslate"><span class="pre">distance</span></code> argument.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, ax = plt.subplots(figsize=(10,5))
fcl_less_strict.plot_tree(ax=ax,
                          feature_names = [&#39;Age_0&#39;, &#39;Age_1&#39;, &#39;Age_2&#39;, &#39;Age_3&#39;, &#39;Income_0&#39;, &#39;Income_1&#39;, &#39;Income_2&#39;,
       &#39;Income_3&#39;, &#39;C_0&#39;, &#39;C_1&#39;, &#39;C_2&#39;,
       &#39;C_3&#39;, &#39;Emp_0&#39;, &#39;Emp_1&#39;,
       &#39;Emp_2&#39;, &#39;Emp_3&#39;, &#39;Edu_0&#39;,
       &#39;Edu_1&#39;, &#39;Edu_2&#39;, &#39;Edu_3&#39;],
         distance=0.6)
plt.show()
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_FairOCT_23_0.png" src="../_images/notebooks_FairOCT_23_0.png" />
</div>
</div>
</section>
<section id="Initialize-FairSPOCT-classifier-with-a-stricter-fairness-bound">
<h3>Initialize FairSPOCT classifier with a stricter fairness bound<a class="headerlink" href="#Initialize-FairSPOCT-classifier-with-a-stricter-fairness-bound" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fcl_strict = FairSPOCT(
    solver=&quot;gurobi&quot;,
    positive_class=1,
    depth=3,
    _lambda=0.01,
    time_limit=60,
    fairness_bound=0.05,
    num_threads=None,
    obj_mode=&quot;acc&quot;,
    verbose=False,
)
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Set parameter Username
Academic license - for non-commercial use only - expires 2025-06-28
Set parameter TimeLimit to value 60
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Fit the classifier
fcl_strict.fit(X=X_train_bin,
                    y=y_train.values,
                    protect_feat=gender_train.map({&#39;Male&#39;: 0, &#39;Female&#39;: 1}).values.reshape(-1,1),
                    legit_factor=prev_default_train.values)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Set parameter NodeLimit to value 1073741824
Set parameter SolutionLimit to value 1073741824
Set parameter IntFeasTol to value 1e-06
Set parameter Method to value 3
Gurobi Optimizer version 10.0.2 build v10.0.2rc0 (mac64[arm])

CPU model: Apple M1 Pro
Thread count: 8 physical cores, 8 logical processors, using up to 8 threads

Optimize a model with 7232 rows, 3785 columns and 29354 nonzeros
Model fingerprint: 0x7a7d351e
Variable types: 30 continuous, 3755 integer (3755 binary)
Coefficient statistics:
  Matrix range     [2e-02, 1e+00]
  Objective range  [1e-02, 1e+00]
  Bounds range     [1e+00, 1e+00]
  RHS range        [5e-02, 1e+00]
Found heuristic solution: objective 56.4300000
Presolve removed 3367 rows and 968 columns
Presolve time: 0.20s
Presolved: 3865 rows, 2817 columns, 21981 nonzeros
Variable types: 28 continuous, 2789 integer (2787 binary)
Concurrent LP optimizer: primal simplex, dual simplex, and barrier
Showing barrier log only...

Root barrier log...

Ordering time: 0.06s

Barrier statistics:
 Dense cols : 31
 AA&#39; NZ     : 9.482e+04
 Factor NZ  : 3.109e+05 (roughly 5 MB of memory)
 Factor Ops : 6.778e+07 (less than 1 second per iteration)
 Threads    : 6

                  Objective                Residual
Iter       Primal          Dual         Primal    Dual     Compl     Time
   0   3.56897422e+03  3.58312641e+04  2.51e+02 2.35e-01  4.49e+01     0s
   1   2.60794849e+03  3.16134346e+04  1.84e+02 1.38e+00  2.52e+01     0s
   2   2.96551428e+02  1.88011056e+04  1.79e+01 8.11e-04  3.83e+00     0s
   3   1.05663007e+02  5.30675595e+03  4.41e+00 1.26e-03  8.77e-01     0s
   4   4.58629616e+01  8.29251644e+02  1.52e-01 4.53e-04  9.13e-02     0s
   5   5.50336865e+01  1.43154251e+02  3.47e-03 5.50e-05  9.83e-03     0s
   6   7.07618020e+01  1.01799613e+02  6.51e-04 1.57e-05  3.46e-03     0s
   7   7.71322505e+01  8.18862169e+01  1.46e-04 2.40e-06  5.31e-04     0s
   8   7.91254856e+01  7.92213777e+01  1.65e-06 1.45e-07  1.07e-05     0s
   9   7.91623691e+01  7.92031912e+01  3.24e-07 7.70e-08  4.55e-06     0s
  10   7.91746197e+01  7.91934019e+01  8.97e-08 3.95e-08  2.09e-06     0s
  11   7.91797439e+01  7.91859055e+01  1.84e-08 1.34e-08  6.88e-07     0s
  12   7.91812351e+01  7.91835130e+01  3.08e-09 5.84e-09  2.54e-07     0s
  13   7.91814581e+01  7.91818461e+01  1.56e-09 5.12e-10  4.36e-08     0s
  14   7.91816584e+01  7.91816746e+01  1.41e-10 2.60e-11  1.81e-09     0s
  15   7.91816667e+01  7.91816667e+01  4.68e-12 3.14e-13  1.82e-12     0s

Barrier solved model in 15 iterations and 0.33 seconds (0.42 work units)
Optimal objective 7.91816667e+01


Solved with barrier

Root relaxation: objective 7.918167e+01, 322 iterations, 0.13 seconds (0.14 work units)

    Nodes    |    Current Node    |     Objective Bounds      |     Work
 Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time

     0     0   79.18167    0  708   56.43000   79.18167  40.3%     -    0s
     0     0   79.18130    0  694   56.43000   79.18130  40.3%     -    0s
     0     0   79.18130    0  664   56.43000   79.18130  40.3%     -    0s
     0     0   79.18000    0  762   56.43000   79.18000  40.3%     -    0s
     0     0   79.18000    0  755   56.43000   79.18000  40.3%     -    0s
     0     0   79.18000    0  771   56.43000   79.18000  40.3%     -    0s
     0     0   79.18000    0  771   56.43000   79.18000  40.3%     -    0s
H    0     0                      60.3600000   79.18000  31.2%     -    0s
     0     0   79.18000    0  767   60.36000   79.18000  31.2%     -    0s
     0     0   79.17882    0  757   60.36000   79.17882  31.2%     -    0s
H    0     2                      73.2000000   79.17838  8.17%     -    0s
     0     2   79.17838    0  757   73.20000   79.17838  8.17%     -    0s
H   79    47                      75.1800000   79.17838  5.32%   209    1s
H  266    99                      75.1900000   79.17838  5.30%   164    2s
  1831   427   77.84500   16  295   75.19000   78.19003  3.99%   124    5s
* 4038   448              32      76.1600000   77.16000  1.31%   104    6s

Cutting planes:
  Gomory: 6
  Cover: 21
  Zero half: 19

Explored 5421 nodes (516269 simplex iterations) in 6.90 seconds (11.48 work units)
Thread count was 8 (of 8 available processors)

Solution count 6: 76.16 75.19 75.18 ... 56.43

Optimal solution found (tolerance 1.00e-04)
Best objective 7.616000000000e+01, best bound 7.616000000000e+01, gap 0.0000%
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FairSPOCT(solver=gurobi,depth=3,time_limit=60,num_threads=None,verbose=False)
</pre></div></div>
</div>
<p>Checking the <code class="docutils literal notranslate"><span class="pre">optim_gap</span></code> again:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fcl_strict.optim_gap
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.0
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>sp_metric = fcl_strict.calc_metric(
        protect_feat=gender_test.map({&#39;Male&#39;: 0, &#39;Female&#39;: 1}).values.reshape(-1,1),
        y= fcl_less_strict.predict(X_test_bin))
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Evaluate fairness and accuracy on the testing set
print(&quot;Statistical Parity on Testing Set (Stricter Fairness Bound):&quot;)
print(pd.DataFrame(
    sp_metric.items(),
    columns=[&quot;(p,y)&quot;, &quot;P(Y=y|P=p)&quot;],
))
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Statistical Parity on Testing Set (Stricter Fairness Bound):
    (p,y)  P(Y=y|P=p)
0  (0, 0)    0.928571
1  (1, 0)    0.500000
2  (0, 1)    0.071429
3  (1, 1)    0.500000
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>test_acc = np.mean(fcl_strict.predict(X_test_bin) == y_test)
print(f&quot;Test Accuracy (Stricter Fairness Bound): {test_acc:.3f}&quot;)
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Test Accuracy (Stricter Fairness Bound): 0.850
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, ax = plt.subplots(figsize=(10,5))
fcl_strict.plot_tree(ax=ax,
                          feature_names = [&#39;Age_0&#39;, &#39;Age_1&#39;, &#39;Age_2&#39;, &#39;Age_3&#39;, &#39;Income_0&#39;, &#39;Income_1&#39;, &#39;Income_2&#39;,
       &#39;Income_3&#39;, &#39;C_0&#39;, &#39;C_1&#39;, &#39;C_2&#39;,
       &#39;C_3&#39;, &#39;Emp_0&#39;, &#39;Emp_1&#39;,
       &#39;Emp_2&#39;, &#39;Emp_3&#39;, &#39;Edu_0&#39;,
       &#39;Edu_1&#39;, &#39;Edu_2&#39;, &#39;Edu_3&#39;],
         distance=0.6)
plt.show()
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_FairOCT_32_0.png" src="../_images/notebooks_FairOCT_32_0.png" />
</div>
</div>
<p>Comparing the results of the two FairSPOCT classifiers with different fairness bound values, we can observe the following:</p>
<ol class="arabic simple">
<li><p>The classifier with a less strict fairness bound (0.2) allows for a larger difference in the probability of loan approval between males and females. The statistical parity metric shows that the probability of loan approval is higher for one gender group compared to the other.</p></li>
<li><p>In contrast, the classifier with a stricter fairness bound (0.05) enforces a much smaller difference in the probability of loan approval between males and females. The statistical parity metric is closer to being equal for both gender groups.</p></li>
<li><p>The decision trees learned by the two classifiers may differ in structure and the features used for splitting, as the stricter fairness bound constrains the tree learning process to ensure a more balanced outcome across the protected groups.</p></li>
<li><p>The accuracy of the classifier with a stricter fairness bound may be slightly lower compared to the classifier with a less strict fairness bound. This is because enforcing a stricter fairness constraint can limit the classifier’s ability to optimize for accuracy.</p></li>
</ol>
<p>These observations demonstrate the trade-off between fairness and accuracy when using fairness constraints in decision tree learning. By adjusting the fairness bound value, users can control the level of fairness enforced in the learned tree, while considering the potential impact on accuracy.</p>
</section>
</section>
<section id="Additional-Supported-Fairness-Metrics">
<h2>Additional Supported Fairness Metrics<a class="headerlink" href="#Additional-Supported-Fairness-Metrics" title="Link to this heading">¶</a></h2>
<p>Now that we have seen how the FairSPOCT class can be used to learn fair optimal classification trees and the impact of the fairness bound on the learned trees and fairness metrics, let’s explore the other fairness metrics available in the ODTlearn package.</p>
<p>In the previous sections, we focused on using the FairSPOCT class to learn fair optimal classification trees with statistical parity constraints. However, the ODTlearn package provides implementations for several other fairness metrics, each capturing different aspects of fairness. These include:</p>
<ul class="simple">
<li><p>FairCSPOCT: Enforces conditional statistical parity</p></li>
<li><p>FairPEOCT: Enforces predictive equality</p></li>
<li><p>FairEOppOCT: Enforces equal opportunity</p></li>
<li><p>FairEOddsOCT: Enforces equalized odds</p></li>
</ul>
<p>Each of these classes follows a similar interface to FairSPOCT, with the main difference being the fairness metric they enforce.</p>
<p>Here’s an overview of each fairness metric and how it is calculated:</p>
<ol class="arabic simple">
<li><p>Statistical Parity (FairSPOCT):</p>
<ul class="simple">
<li><p>Definition: A classifier satisfies statistical parity if the probability of receiving a positive outcome is equal across all protected groups.</p></li>
<li><p>Equation: <img class="math" src="../_images/math/d3b5e3e49096b2021e324113f57a826917cb364b.png" alt="P(\hat{Y} = 1 | A = a) = P(\hat{Y} = 1 | A = b), \forall a, b"/></p></li>
<li><p><img class="math" src="../_images/math/e17cbfdc13f71a51b1bcc3eaf01617769969441c.png" alt="\hat{Y}"/> is the predicted outcome, and <img class="math" src="../_images/math/211284f68205c3e66773eaf026f32a0acdd3dfb3.png" alt="A"/> is the protected attribute.</p></li>
</ul>
</li>
<li><p>Conditional Statistical Parity (FairCSPOCT):</p>
<ul class="simple">
<li><p>Definition: A classifier satisfies conditional statistical parity if the probability of receiving a positive outcome is equal across all protected groups, conditioned on a set of legitimate factors.</p></li>
<li><p>Equation: <img class="math" src="../_images/math/57944d0089c92dd52cd8a5e8a12a45944c2ec4b4.png" alt="P(\hat{Y} = 1 | A = a, L = l) = P(\hat{Y} = 1 | A = b, L = l), \forall a, b, l"/></p></li>
<li><p><img class="math" src="../_images/math/e17cbfdc13f71a51b1bcc3eaf01617769969441c.png" alt="\hat{Y}"/> is the predicted outcome, <img class="math" src="../_images/math/211284f68205c3e66773eaf026f32a0acdd3dfb3.png" alt="A"/> is the protected attribute, and <img class="math" src="../_images/math/19eef1966f7c545af3ac8c0fa486974d873e3c65.png" alt="L"/> represents the legitimate factors.</p></li>
</ul>
</li>
<li><p>Predictive Equality (FairPEOCT):</p>
<ul class="simple">
<li><p>Definition: A classifier satisfies predictive equality if the false positive rates are equal across all protected groups.</p></li>
<li><p>Equation: <img class="math" src="../_images/math/c4831094d8fff9286bfefdad2000caa38e0474f0.png" alt="P(\hat{Y} = 1 | Y = 0, A = a) = P(\hat{Y} = 1 | Y = 0, A = b), \forall a, b"/></p></li>
<li><p><img class="math" src="../_images/math/e17cbfdc13f71a51b1bcc3eaf01617769969441c.png" alt="\hat{Y}"/> is the predicted outcome, <img class="math" src="../_images/math/7daf0d4815e763eb90f0d5f1dc406f668c1e21db.png" alt="Y"/> is the true outcome, and <img class="math" src="../_images/math/211284f68205c3e66773eaf026f32a0acdd3dfb3.png" alt="A"/> is the protected attribute.</p></li>
</ul>
</li>
<li><p>Equal Opportunity (FairEOppOCT):</p>
<ul class="simple">
<li><p>Definition: A classifier satisfies equal opportunity if the true positive rates are equal across all protected groups.</p></li>
<li><p>Equation: <img class="math" src="../_images/math/7f93377d2c16556d74f2811d0fff626396197a76.png" alt="P(\hat{Y} = 1 | Y = 1, A = a) = P(\hat{Y} = 1 | Y = 1, A = b), \forall a, b"/></p></li>
<li><p><img class="math" src="../_images/math/e17cbfdc13f71a51b1bcc3eaf01617769969441c.png" alt="\hat{Y}"/> is the predicted outcome, <img class="math" src="../_images/math/7daf0d4815e763eb90f0d5f1dc406f668c1e21db.png" alt="Y"/> is the true outcome, and <img class="math" src="../_images/math/211284f68205c3e66773eaf026f32a0acdd3dfb3.png" alt="A"/> is the protected attribute.</p></li>
</ul>
</li>
<li><p>Equalized Odds (FairEOddsOCT):</p>
<ul class="simple">
<li><p>Definition: A classifier satisfies equalized odds if both the true positive rates and false positive rates are equal across all protected groups.</p></li>
<li><p>Equation: <img class="math" src="../_images/math/5c7123a1960d95a3fa63ec337f8baacdb7276d89.png" alt="P(\hat{Y} = 1 | Y = y, A = a) = P(\hat{Y} = 1 | Y = y, A = b), \forall a, b, y \in \{0, 1\}"/></p></li>
<li><p><img class="math" src="../_images/math/e17cbfdc13f71a51b1bcc3eaf01617769969441c.png" alt="\hat{Y}"/> is the predicted outcome, <img class="math" src="../_images/math/7daf0d4815e763eb90f0d5f1dc406f668c1e21db.png" alt="Y"/> is the true outcome, and <img class="math" src="../_images/math/211284f68205c3e66773eaf026f32a0acdd3dfb3.png" alt="A"/> is the protected attribute.</p></li>
</ul>
</li>
</ol>
<p>When applying fairness constraints to a decision tree, it is crucial to carefully choose a fairness metric that aligns with the specific use case and the societal or legal requirements of the problem at hand. Different fairness metrics capture different aspects of fairness and may lead to different trade-offs between fairness and accuracy.</p>
<p>For example, if the goal is to ensure that the overall proportion of positive outcomes is similar across protected groups, statistical parity (FairSPOCT) would be an appropriate choice. However, if the focus is on ensuring that the classifier makes similar mistakes across protected groups, predictive equality (FairPEOCT) might be more suitable.</p>
<p>It is important to note that achieving fairness in machine learning is a complex and ongoing process that requires careful consideration of the societal context, potential biases in the data, and the limitations of the chosen fairness metric. Engaging with domain experts, stakeholders, and affected communities is essential to understand the specific fairness requirements of the problem and select the most appropriate fairness metric or combination of metrics.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="RobustOCT.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><code class="docutils literal notranslate"><span class="pre">RobustOCT</span></code> Examples</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="FlowOCT.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><code class="docutils literal notranslate"><span class="pre">FlowOCT</span></code> Examples</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/D3M-Research-Group/odtlearn" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Fair Optimal Classification Trees</a><ul>
<li><a class="reference internal" href="#Introduction">Introduction</a></li>
<li><a class="reference internal" href="#Loan-Approval-Dataset">Loan Approval Dataset</a></li>
<li><a class="reference internal" href="#Learning-Fair-Optimal-Classification-Trees-with-Statistical-Parity">Learning Fair Optimal Classification Trees with Statistical Parity</a><ul>
<li><a class="reference internal" href="#Initialize-FairSPOCT-classifier-with-a-less-strict-fairness-bound">Initialize FairSPOCT classifier with a less strict fairness bound</a></li>
<li><a class="reference internal" href="#Initialize-FairSPOCT-classifier-with-a-stricter-fairness-bound">Initialize FairSPOCT classifier with a stricter fairness bound</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Additional-Supported-Fairness-Metrics">Additional Supported Fairness Metrics</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=85817b6e"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=4e2eecee"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=4ea706d9"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>